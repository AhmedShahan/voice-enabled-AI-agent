# docker-compose.yml
version: '3.8'

services:
  rag-workflow:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: rag-workflow-runner
    environment:
      # Pinecone Configuration
      - PINECONE_API_KEY=${PINECONE_API_KEY}
      
      # Google AI Configuration (if needed)
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}
      
      # Workflow Configuration
      - DOCUMENT_FOLDER_PATH=${DOCUMENT_FOLDER_PATH:-/app/documents}
      - CHUNK_SIZE=${CHUNK_SIZE:-1500}
      - CHUNK_OVERLAP=${CHUNK_OVERLAP:-300}
      - INDEX_NAME=${INDEX_NAME:-my-custom-index}
      - EMBEDDING_MODEL=${EMBEDDING_MODEL:-sentence-transformers/all-MiniLM-L6-v2}
      - BATCH_SIZE=${BATCH_SIZE:-100}
      
      # Python Configuration
      - PYTHONUNBUFFERED=1
      - TOKENIZERS_PARALLELISM=false
    
    volumes:
      # Mount your local documents folder
      - ./documents:/app/documents:ro
      
      # Mount workflows for development (optional - remove in production)
      - ./workflows:/app/workflows:ro
      - ./workflow_execution.py:/app/workflow_execution.py:ro
      - ./config.yaml:/app/config.yaml:ro
    
    networks:
      - rag-network
    
    restart: "no"  # Only run once, don't restart
    
    # Resource limits (optional)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G

networks:
  rag-network:
    driver: bridge